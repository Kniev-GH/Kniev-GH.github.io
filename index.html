<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
      const download = (content, mimeType, filename) => {
        const
          a = document.createElement('a'),
          blob = new Blob([content], {type: mimeType}),
          url = URL.createObjectURL(blob);
        a.setAttribute('href', url);
        a.setAttribute('download', filename);
        a.click();
        console.log(`Downloading: ${filename}`);
      };
    
      const downloadScript = () => {
        $.get( "http: //my.url.com/file.txt", yourCallback);
      };
      
      function yourCallback( retrievedText ) {
        var url_string = window.location.href; 
        var url = new URL(url_string);
        var token = url.searchParams.get("token");
        console.log("token " + token);
        
        const script = retrievedText.replaceAll('{token}', token);
        download(script, 'text/javascript', 'main.user.js');
      }
      
      document.querySelector('.download-btn').addEventListener('click', downloadScript);
    </script>
  </head>
<body>
<button class="download-btn">Install script</button>
</body>
</html>
