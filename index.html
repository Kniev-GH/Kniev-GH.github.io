<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
      const download = (content, mimeType, filename) => {
        console.log('download');
        const
          a = document.createElement('a'),
          blob = new Blob([content], {type: mimeType}),
          url = URL.createObjectURL(blob);
        a.setAttribute('href', url);
        a.setAttribute('download', filename);
        a.click();
        console.log(`Downloading: ${filename}`);
      };
    
      const downloadScript = () => {
        console.log('downloadScript');
        $.get( "http: //my.url.com/file.txt", yourCallback);
      };
      
      function yourCallback(retrievedText) {
        console.log('callback');
        var url_string = window.location.href; 
        var url = new URL(url_string);
        var token = url.searchParams.get("token");
        console.log("token " + token);
        
        const script = retrievedText.replaceAll('{token}', token);
        download(script, 'text/javascript', 'main.user.js');
      }

      $(document).ready(function() {
        $("#install").click(downloadScript);
        console.log('ready'); 
      });
    </script>
  </head>
<body>
<button id="install">Install script</button>
</body>
</html>
